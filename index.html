<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YODY Internal Network Monitoring</title>

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- PapaParse for CSV -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>

    <!-- LOADING SCREEN -->
    <div id="loading">
        <div class="spinner"></div>
        <div style="color:var(--accent-color); font-weight:600; margin-top:10px;">ƒêang t·∫£i d·ªØ li·ªáu...</div>
    </div>

    <!-- LOGIN SCREEN -->
    <div id="login-screen">
        <div class="login-box">
            <img src="https://yody.vn/images/logo.png" style="height:40px; margin-bottom:20px;">
            <h2>CH√ÄO M·ª™NG TR·ªû L·∫†I</h2>
            <p>Vui l√≤ng ƒëƒÉng nh·∫≠p v·ªõi email @yody.vn</p>
            <input type="email" class="login-input" id="email-input" placeholder="nhanvien@yody.vn">
            <button class="login-btn" onclick="handleLogin()">ƒêƒÇNG NH·∫¨P</button>
            <div class="login-error" id="login-error"></div>
        </div>
    </div>

    <!-- NAVIGATION -->
    <nav class="nav-bar">
        <img src="https://yody.vn/images/logo.png" alt="YODY" class="nav-logo"
            onerror="this.style.display='none'; document.querySelector('.nav-bar').insertAdjacentHTML('afterbegin', '<span style=\'font-weight:900; font-size:24px; color:#fcb900; margin-right:40px;\'>YODY</span>')">

        <div class="nav-items">
            <div class="nav-item active" onclick="scrollToSection('home-section')">TRANG CH·ª¶</div>
            <div class="nav-item" onclick="scrollToSection('map-section')">B·∫¢N ƒê·ªí</div>
            <div class="nav-item" onclick="scrollToSection('report-section')">B√ÅO C√ÅO</div>
        </div>

        <div style="margin-left:auto; display:flex; gap:16px;">
            <button id="theme-toggle-btn" class="nav-item"
                style="background:rgba(255,255,255,0.1); border:none; border-radius:8px; padding:8px 16px;">
                <span>üåô</span> T·ªëi
            </button>
        </div>

        <!-- Mobile Menu -->
        <button class="mobile-menu-btn" onclick="toggleMobileSidebar()"
            style="display:none; background:none; border:none; color:#fff; font-size:24px; cursor:pointer; margin-left:10px;">
            ‚ò∞
        </button>
    </nav>

    <!-- NEWS TICKER -->
    <div id="news-ticker">
        <div class="ticker-content" id="ticker-content">
            <!-- Items injected by JS -->
        </div>
    </div>

    <!-- HOME SECTION -->
    <section id="home-section">
        <div class="hero-section">
            <img src="https://yody.vn/images/logo.png" class="hero-logo" style="height:60px;">
            <div class="hero-text">
                "Cung c·∫•p th√¥ng tin nhanh ch√≥ng, ch√≠nh x√°c v·ªÅ t√¨nh h√¨nh an ninh, an to√†n t·∫°i h·ªá th·ªëng c·ª≠a h√†ng YODY."
            </div>
            <div class="hero-btn" onclick="scrollToSection('map-section')" style="cursor:pointer;">XEM B·∫¢N ƒê·ªí TR·ª∞C TUY·∫æN
            </div>
        </div>

        <div style="text-align:center; margin-top:60px;">
            <h2 style="font-size:24px; color:var(--text-color); margin-bottom:12px; text-transform:uppercase;">Tin t·ª©c
                ho·∫°t ƒë·ªông</h2>
            <div style="width:60px; height:4px; background:var(--accent-color); margin:0 auto; border-radius:2px;">
            </div>
        </div>

        <div class="wall-grid" id="wall-grid">
            <!-- News Cards injected by JS -->
        </div>
    </section>

    <!-- MAP SECTION -->
    <section id="map-section">
        <!-- Sidebar Left -->
        <div class="sidebar">
            <div class="header">
                <div style="display:flex; align-items:center; gap:12px;">
                    <div class="header-icon">üõ°Ô∏è</div>
                    <div>
                        <h1>AN NINH N·ªòI B·ªò</h1>
                        <div class="header-subtitle">Gi√°m s√°t r·ªßi ro h·ªá th·ªëng</div>
                    </div>
                </div>
            </div>

            <div class="sidebar-search">
                <input type="text" id="store-search" class="search-input" placeholder="T√¨m c·ª≠a h√†ng (T√™n, ƒê/C)..."
                    onkeyup="handleSearch(this.value)">
                <div id="search-results" class="search-results"></div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">L·ªçc d·ªØ li·ªáu</div>
                <div class="filter-option active" onclick="setDisplayFilter('all')">
                    <div class="filter-radio"></div>
                    <span class="filter-label">T·∫•t c·∫£ c·ª≠a h√†ng</span>
                </div>
                <div class="filter-option" onclick="setDisplayFilter('violations')">
                    <div class="filter-radio"></div>
                    <span class="filter-label">C√≥ s·ª± v·ª• / R·ªßi ro</span>
                </div>
                <div class="filter-option" onclick="setDisplayFilter('clean')">
                    <div class="filter-radio"></div>
                    <span class="filter-label">C·ª≠a h√†ng an to√†n</span>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Th·ªëng k√™ t·ªïng quan</div>
                <div class="stat-card">
                    <div class="stat-icon stores">üè¢</div>
                    <div class="stat-content">
                        <div class="stat-value" id="stat-total-stores">0</div>
                        <div class="stat-label">T·ªïng c·ª≠a h√†ng</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon violations">‚ö†Ô∏è</div>
                    <div class="stat-content">
                        <div class="stat-value" id="stat-total-violations">0</div>
                        <div class="stat-label">S·ª± v·ª• ghi nh·∫≠n</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon rewards">üèÜ</div>
                    <div class="stat-content">
                        <div class="stat-value" id="stat-total-rewards">0</div>
                        <div class="stat-label">Khen th∆∞·ªüng</div>
                    </div>
                </div>
            </div>

            <div style="margin-top:auto; font-size:11px; opacity:0.3; text-align:center; padding-bottom:20px;">
                YODY SECURITY PORTAL v2.0 <br> Cloud Optimized
            </div>
        </div>

        <!-- Main Map -->
        <div id="map"></div>

        <!-- Floating Stats (Right) -->
        <div id="om-stats">
            <div class="om-title">Top C·∫£nh B√°o</div>
            <div id="om-list">
                <!-- Top list injected by JS -->
            </div>
        </div>

        <!-- Custom Popup (Right Sidebar) -->
        <div id="custom-popup">
            <div class="popup-header">
                <button class="popup-close" onclick="closePopup()">‚úï</button>
                <h3 id="popup-title">T√™n c·ª≠a h√†ng</h3>
                <div id="popup-address" style="font-size:12px; opacity:0.6; margin-top:4px;">ƒê·ªãa ch·ªâ</div>
                <div class="popup-tabs">
                    <div class="popup-tab violations active" onclick="switchTab('violations')">S·ª± v·ª•</div>
                    <div class="popup-tab rewards" onclick="switchTab('highlights')">Khen th∆∞·ªüng</div>
                </div>
            </div>

            <div id="popup-views" style="position:relative; flex:1; overflow:hidden;">
                <!-- List View -->
                <div id="view-list" style="position:absolute; inset:0; overflow-y:auto; padding:24px;">
                    <div id="popup-body"></div>
                </div>

                <!-- Detail View -->
                <div id="view-detail"
                    style="position:absolute; inset:0; background:var(--popup-bg); transform:translateX(100%); transition:0.3s; padding:24px; overflow-y:auto;">
                    <button onclick="backToList()"
                        style="background:none; border:none; color:var(--accent-color); font-weight:700; cursor:pointer; margin-bottom:20px;">‚Üê
                        QUAY L·∫†I</button>
                    <div id="detail-body"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- REPORT SECTION -->
    <section id="report-section">
        <div class="report-box">
            <h2 style="text-align:center; margin-bottom:30px;">G·ª≠i ph·∫£n √°nh ·∫©n danh</h2>
            <iframe
                src="https://docs.google.com/forms/d/e/1FAIpQLScrXACk6KHdNz0kkWKy2FynUR2xz1GIRJdHdbgGhfPPkGYwig/viewform?embedded=true"
                width="100%" height="800" frameborder="0" marginheight="0" marginwidth="0"
                style="border-radius:12px; background:transparent;">ƒêang t·∫£i form...</iframe>
            <p style="text-align:center; font-size:11px; margin-top:20px; color:var(--text-muted);">
                * D·ªØ li·ªáu ƒë∆∞·ª£c b·∫£o m·∫≠t v√† g·ª≠i tr·ª±c ti·∫øp v·ªÅ Ban ki·ªÉm so√°t.
            </p>
        </div>
    </section>

    <!-- FOOTER -->
    <div class="footer">
        <h3 style="font-size: 18px; margin-bottom: 20px; color: var(--text-color);">TH√îNG TIN LI√äN H·ªÜ</h3>
        <div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <span>üìç</span>
                <span>ƒê·ªãa ch·ªâ: C√¥ng ty YODY, ƒë∆∞·ªùng An ƒê·ªãnh, ph∆∞·ªùng Vi·ªát H√≤a, th√†nh ph·ªë H·∫£i Ph√≤ng</span>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <span>üìû</span>
                <span>Hotline: 0888 673 258</span>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <span>‚úâÔ∏è</span>
                <span>Email: Anninhnoibo@yody.vn</span>
            </div>
        </div>
        <p style="font-style: italic; color: var(--text-muted); font-size: 13px;">
            T√†i li·ªáu n·ªôi b·ªô c·ªßa Yody. Nghi√™m c·∫•m h√†nh vi sao ch√©p, chia s·∫ª, ph√°t t√°n d∆∞·ªõi m·ªçi h√¨nh th·ª©c.
        </p>
    </div>

    <!-- News Modal -->
    <div id="global-news-modal"
        style="position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:20000; display:none; align-items:center; justify-content:center; padding:20px;">
        <div class="news-modal-container"
            style="width:100%; max-width:800px; max-height:90vh; border-radius:16px; overflow:hidden; display:flex; flex-direction:column; position:relative;">
            <button onclick="closeNewsModal()"
                style="position:absolute; top:20px; right:20px; background:none; border:none; color:#fff; font-size:24px; cursor:pointer; z-index:2;">‚úï</button>
            <div id="global-news-body" style="padding:40px; overflow-y:auto; flex:1;"></div>
        </div>
    </div>

    <style>
        #global-news-modal.active {
            display: flex;
        }
    </style>

    <!-- App Logic -->
    <script src="js/app.js"></script>
</body>

</html>