<!DOCTYPE html>
<html lang="vi" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YODY Internal Network Monitoring</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- PapaParse (For CSV Fallback) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>

    <!-- LOADING SCREEN -->
    <div id="loading">
        <div class="spinner"></div>
        <div style="color:#667eea; font-weight:600; margin-top:10px;">ƒêang t·∫£i d·ªØ li·ªáu...</div>
    </div>

    <!-- LOGIN SCREEN -->
    <div id="login-screen">
        <div class="login-box">
            <h2>YODY INTERNAL</h2>
            <p>Vui l√≤ng ƒëƒÉng nh·∫≠p b·∫±ng email @yody.vn</p>
            <input type="email" id="email-input" class="login-input" placeholder="nhanvien@yody.vn">
            <button class="login-btn" onclick="handleLogin()">ƒêƒÇNG NH·∫¨P</button>
            <div id="login-error" class="login-error"></div>
        </div>
    </div>

    <!-- NAVIGATION -->
    <nav class="nav-bar">
        <img src="https://yody.vn/images/logo.png" alt="YODY" class="nav-logo"
            onerror="this.style.display='none'; document.querySelector('.nav-bar').insertAdjacentHTML('afterbegin', '<span style=\'font-weight:900; font-size:24px; color:#fcb900; margin-right:40px;\'>YODY</span>')">

        <div class="nav-items">
            <a href="#home-section" class="nav-item active">TRANG CH·ª¶</a>
            <a href="#map-section" class="nav-item">B·∫¢N ƒê·ªí</a>
            <a href="#report-section" class="nav-item">B√ÅO C√ÅO</a>
        </div>

        <div style="margin-left:auto; display:flex; gap:16px;">
            <button id="theme-toggle-btn" class="nav-item" style="background:rgba(255,255,255,0.1); border:none;">
                <span>üåô</span> Giao di·ªán
            </button>
        </div>

        <!-- Mobile Menu Button -->
        <button class="mobile-menu-btn" onclick="toggleMobileSidebar()" style="display:none;">
            <span>‚ò∞</span> MEMU
        </button>
    </nav>

    <!-- NEWS TICKER -->
    <div id="news-ticker">
        <div class="ticker-content" id="ticker-content">
            <!-- Items injected by JS -->
        </div>
    </div>

    <!-- HOME SECTION -->
    <section id="home-section">
        <div class="hero-section">
            <img src="https://yody.vn/images/logo.png" class="hero-logo"
                style="height:60px; filter:brightness(0) invert(1);">
            <div class="hero-text">
                "Cung c·∫•p th√¥ng tin nhanh ch√≥ng, ch√≠nh x√°c v·ªÅ t√¨nh h√¨nh an ninh, an to√†n t·∫°i h·ªá th·ªëng c·ª≠a h√†ng YODY."
            </div>
            <a href="#map-section" class="hero-btn">XEM B·∫¢N ƒê·ªí TR·ª∞C TUY·∫æN</a>
        </div>

        <div style="text-align:center; margin-top:60px;">
            <h2 style="font-size:24px; color:var(--text-color); margin-bottom:12px;">TIN T·ª®C HO·∫†T ƒê·ªòNG</h2>
            <div style="width:60px; height:4px; background:var(--accent-color); margin:0 auto; border-radius:2px;">
            </div>
        </div>

        <div class="wall-grid" id="wall-grid">
            <!-- News Cards injected by JS -->
        </div>
    </section>

    <!-- MAP SECTION -->
    <section id="map-section">
        <!-- Sidebar Left -->
        <div class="sidebar">
            <div class="header">
                <div style="display:flex; align-items:center; gap:12px;">
                    <div class="header-icon">üõ°Ô∏è</div>
                    <div>
                        <h1>AN NINH N·ªòI B·ªò</h1>
                        <div class="header-subtitle">H·ªá th·ªëng gi√°m s√°t r·ªßi ro</div>
                    </div>
                </div>
            </div>

            <div class="sidebar-search">
                <input type="text" id="store-search" class="search-input" placeholder="T√¨m c·ª≠a h√†ng (T√™n, ƒê/C)..."
                    onkeyup="handleSearch(this.value)">
                <div id="search-results" class="search-results"></div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">L·ªåC D·ªÆ LI·ªÜU</div>
                <div class="filter-option active" onclick="setDisplayFilter('all')">
                    <div class="filter-radio"></div>
                    <span class="filter-label">T·∫•t c·∫£ c·ª≠a h√†ng</span>
                </div>
                <div class="filter-option" onclick="setDisplayFilter('violations')">
                    <div class="filter-radio"></div>
                    <span class="filter-label">C√≥ s·ª± v·ª• / R·ªßi ro</span>
                </div>
                <div class="filter-option" onclick="setDisplayFilter('clean')">
                    <div class="filter-radio"></div>
                    <span class="filter-label">C·ª≠a h√†ng an to√†n</span>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">TH·ªêNG K√ä T·ªîNG QUAN</div>
                <div class="stat-card">
                    <div class="stat-icon stores">üè¢</div>
                    <div class="stat-content">
                        <div class="stat-value" id="stat-total-stores">0</div>
                        <div class="stat-label">T·ªïng c·ª≠a h√†ng</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon violations">‚ö†Ô∏è</div>
                    <div class="stat-content">
                        <div class="stat-value" id="stat-total-violations">0</div>
                        <div class="stat-label">S·ª± v·ª• ghi nh·∫≠n</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon rewards">üèÜ</div>
                    <div class="stat-content">
                        <div class="stat-value" id="stat-total-rewards">0</div>
                        <div class="stat-label">Khen th∆∞·ªüng</div>
                    </div>
                </div>
            </div>

            <div style="margin-top:auto; font-size:11px; opacity:0.3; text-align:center;">
                YODY SECURITY MAP v2.0 <br> Cloud Version
            </div>
        </div>

        <!-- Main Map -->
        <div id="map"></div>

        <!-- Overview Stats (Right) -->
        <div id="om-stats">
            <div class="om-title">TOP C·∫¢NH B√ÅO</div>
            <div id="om-list">
                <!-- Top violations list -->
            </div>
        </div>

        <!-- Custom Popup (Right Sidebar Slide-in) -->
        <div id="custom-popup">
            <!-- Header -->
            <div class="popup-header">
                <button class="popup-close" onclick="closePopup()">‚úï</button>
                <div id="view-list" class="view-section" style="position:static;">
                    <h3 id="popup-title">Store Name</h3>
                    <div class="address" id="popup-address">Title address</div>
                    <div class="popup-tabs">
                        <div class="popup-tab violations active" onclick="switchTab('violations')">S·ª± v·ª•</div>
                        <div class="popup-tab rewards" onclick="switchTab('highlights')">Khen th∆∞·ªüng</div>
                    </div>
                </div>
            </div>

            <!-- Body Container -->
            <div id="popup-views">
                <!-- List View -->
                <div id="view-list-body" class="view-section"
                    style="position:absolute; top:0; left:0; width:100%; height:100%;">
                    <div id="popup-body" class="popup-body">
                        <!-- Items -->
                    </div>
                </div>

                <!-- Detail View -->
                <div id="view-detail" class="view-section">
                    <div style="padding:20px; border-bottom:1px solid var(--border-color);">
                        <button class="back-btn" onclick="backToList()">‚Üê Quay l·∫°i danh s√°ch</button>
                        <h3 style="font-size:16px;">Chi ti·∫øt s·ª± v·ª•</h3>
                    </div>
                    <div id="detail-body" class="popup-body">
                        <!-- Details -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- REPORT SECTION -->
    <section id="report-section">
        <div class="report-box">
            <div class="report-title" style="font-size:24px; text-align:center; margin-bottom:20px;">G·ª≠i ph·∫£n √°nh ·∫©n
                danh</div>

            <iframe
                src="https://docs.google.com/forms/d/e/1FAIpQLScrXACk6KHdNz0kkWKy2FynUR2xz1GIRJdHdbgGhfPPkGYwig/viewform?embedded=true"
                width="100%" height="600" frameborder="0" marginheight="0" marginwidth="0"
                style="background:transparent; border-radius:12px;">ƒêang t·∫£i...</iframe>

            <p style="text-align:center; font-size:11px; margin-top:20px; color:var(--text-muted);">
                * D·ªØ li·ªáu ƒë∆∞·ª£c b·∫£o m·∫≠t v√† g·ª≠i tr·ª±c ti·∫øp v·ªÅ Ban ki·ªÉm so√°t.
            </p>
        </div>
    </section>

    <!-- FOOTER -->
    <div class="footer">
        <h3 style="font-size: 18px; margin-bottom: 20px; color: var(--text-color);">TH√îNG TIN LI√äN H·ªÜ</h3>
        <p>üìç ƒê·ªãa ch·ªâ: C√¥ng ty YODY, ƒë∆∞·ªùng An ƒê·ªãnh, ph∆∞·ªùng Vi·ªát H√≤a, th√†nh ph·ªë H·∫£i Ph√≤ng</p>
        <p>üìû Hotline: 0888 673 258</p>
        <p>‚úâÔ∏è Email: Anninhnoibo@yody.vn</p>
        <br>
        <p style="font-style: italic; opacity:0.5;">T√†i li·ªáu n·ªôi b·ªô c·ªßa Yody. Nghi√™m c·∫•m h√†nh vi sao ch√©p, chia s·∫ª.</p>
    </div>

    <!-- GLOBAL NEWS MODAL -->
    <div id="global-news-modal">
        <div class="news-modal-container"
            style="background:var(--popup-bg); padding:20px; border-radius:16px; width:90%; max-width:800px; max-height:90vh; overflow:hidden; display:flex; flex-direction:column; position:relative;">
            <button onclick="closeNewsModal()"
                style="position:absolute; top:20px; right:20px; background:none; border:none; color:#fff; font-size:24px; cursor:pointer;">‚úï</button>
            <div id="global-news-body" style="overflow-y:auto; padding-top:20px;"></div>
        </div>
    </div>
    <style>
        #global-news-modal {
            position: fixed;
            inset: 0;
            z-index: 20000;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
        }
    </style>

    <!-- App Logic -->
    <script src="js/app.js"></script>
</body>

</html>