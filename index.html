<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th∆∞ vi·ªán Qu·∫£n tr·ªã R·ªßi ro</title>

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- PapaParse for CSV -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="nav-bar">
        <img src="./yody-logo.png" alt="Yody" class="nav-logo">
        <div class="nav-items">
            <a class="nav-item active" href="javascript:void(0)" onclick="scrollToSection('home-section')">
                <span>üì∞</span> Trang ch·ªß
            </a>
            <a class="nav-item" href="javascript:void(0)" onclick="scrollToSection('map-section')">
                <span>üó∫Ô∏è</span> B·∫£n ƒë·ªì R·ªßi ro
            </a>
            <a class="nav-item" href="javascript:void(0)" onclick="scrollToSection('report-section')">
                <span>üì¢</span> T·ªë gi√°c ·∫©n danh
            </a>
            <a class="nav-item" href="javascript:void(0)" onclick="toggleTheme()" id="theme-toggle-btn"
                style="min-width: 100px;"><span>üåô</span> T·ªëi</a>
        </div>
    </nav>

    <!-- HOME SECTION -->
    <section id="home-section" class="view-container">
        <!-- Hero Section -->
        <div class="hero-section">
            <div class="hero-text">
                "T·∫°i YODY, ch√∫ng t√¥i hi·ªÉu r·∫±ng trong qu√° tr√¨nh l√†m vi·ªác, c√≥ th·ªÉ ph√°t sinh nh·ªØng ƒëi·ªÅu ch∆∞a ph√π h·ª£p v·ªõi
                gi√° tr·ªã
                c·ªët l√µi, quy chu·∫©n vƒÉn h√≥a ho·∫∑c c√°c h√†nh vi khi·∫øn b·∫°n bƒÉn khoƒÉn.
                <br><br>
                M·ªói g√≥p √Ω, m·ªói ph·∫£n √°nh t·ª´ b·∫°n kh√¥ng ch·ªâ gi√∫p ph√°t hi·ªán v√† ngƒÉn ch·∫∑n k·ªãp th·ªùi nh·ªØng sai l·ªách m√† c√≤n l√†
                ƒë·ªông l·ª±c
                m·∫°nh m·∫Ω ƒë·ªÉ YODY ng√†y c√†ng ho√†n thi·ªán h∆°n. ƒê√¢y l√† c√°ch ch√∫ng ta c√πng nhau x√¢y d·ª±ng m·ªôt m√¥i tr∆∞·ªùng l√†m
                vi·ªác minh
                b·∫°ch ‚Äì c√¥ng b·∫±ng ‚Äì nh√¢n vƒÉn, ƒë·ªìng th·ªùi ƒë√≥ng g√≥p th√™m nhi·ªÅu gi√° tr·ªã t√≠ch c·ª±c cho x√£ h·ªôi v√† c·ªông ƒë·ªìng.
                <br><br>
                üì© <strong>M·ªçi ph·∫£n √°nh ƒë·ªÅu ƒë∆∞·ª£c b·∫£o m·∫≠t tuy·ªát ƒë·ªëi, ti·∫øp nh·∫≠n v√† x·ª≠ l√Ω.</strong>"
            </div>
            <button class="hero-btn" onclick="scrollToSection('report-section')">T·ªê GI√ÅC NGAY</button>
        </div>

        <!-- News Grid -->
        <div class="wall-grid" id="wall-grid">
            <div style="color:var(--text-muted); text-align:center; grid-column: 1/-1; padding: 40px;">ƒêang t·∫£i tin
                t·ª©c...</div>
        </div>
    </section>

    <!-- MAP SECTION -->
    <section id="map-section" class="view-container">
        <div id="map-ui-container" style="position: relative; width: 100%; height: 100%;">

            <!-- News Ticker -->
            <div id="news-ticker">
                <div class="ticker-content" id="ticker-content">
                    <span class="ticker-item">ƒêang t·∫£i tin t·ª©c...</span>
                </div>
            </div>

            <!-- Mobile Menu Button -->
            <button class="mobile-menu-btn" onclick="toggleMobileSidebar()">
                ‚ò∞ Menu
            </button>

            <!-- OM Stats (Right) -->
            <div id="om-stats">
                <div class="om-title">Vi ph·∫°m theo OM</div>
                <div id="om-list">
                    <!-- Items will be populated here -->
                </div>
            </div>

            <!-- Loading Overlay -->
            <div id="loading">
                <div class="spinner"></div>
                <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
            </div>

            <!-- Login Screen -->
            <div id="login-screen" style="display: none;">
                <div class="login-box">
                    <h2>üõ°Ô∏è ƒêƒÉng nh·∫≠p</h2>
                    <p>H·ªá th·ªëng gi√°m s√°t r·ªßi ro n·ªôi b·ªô</p>
                    <input type="email" class="login-input" id="email-input" placeholder="Email@yody.vn">
                    <button class="login-btn" onclick="handleLogin()">ƒêƒÉng nh·∫≠p</button>
                    <div class="login-error" id="login-error"></div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <div class="header">
                    <h1>Th∆∞ vi·ªán Qu·∫£n tr·ªã r·ªßi ro</h1>
                    <div class="header-subtitle">H·ªá th·ªëng gi√°m s√°t v√† ph√¢n t√≠ch vi ph·∫°m to√†n di·ªán</div>
                </div>

                <div class="sidebar-search">
                    <input type="text" class="search-input" id="store-search" placeholder="üîç T√¨m ki·∫øm c·ª≠a h√†ng..."
                        oninput="handleSearch(this.value)">
                    <div class="search-results" id="search-results"></div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-title">Lo·∫°i hi·ªÉn th·ªã</div>
                    <div class="filter-option active" onclick="setDisplayFilter('all')">
                        <div class="filter-radio"></div>
                        <div class="filter-label">T·∫•t c·∫£ c·ª≠a h√†ng</div>
                    </div>
                    <div class="filter-option" onclick="setDisplayFilter('violations')">
                        <div class="filter-radio"></div>
                        <div class="filter-label">C√≥ vi ph·∫°m</div>
                    </div>
                    <div class="filter-option" onclick="setDisplayFilter('clean')">
                        <div class="filter-radio"></div>
                        <div class="filter-label">Kh√¥ng vi ph·∫°m</div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-title">Th·ªëng k√™ t·ªïng quan</div>
                    <div class="stat-card">
                        <div class="stat-icon stores">üè™</div>
                        <div class="stat-content">
                            <div class="stat-value" id="total-stores">0</div>
                            <div class="stat-label">C·ª≠a h√†ng</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon violations">‚ö†Ô∏è</div>
                        <div class="stat-content">
                            <div class="stat-value" id="total-violations">0</div>
                            <div class="stat-label">Vi ph·∫°m</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon rewards">üèÜ</div>
                        <div class="stat-content">
                            <div class="stat-value" id="total-rewards">0</div>
                            <div class="stat-label">Khen th∆∞·ªüng</div>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-title">Top 5 Vi ph·∫°m nhi·ªÅu nh·∫•t</div>
                    <div id="top-violations" style="font-size: 12px;">
                        <!-- Will be populated by JS -->
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-title">Ch·ªâ ti√™u m·ª©c ƒë·ªô</div>
                    <div class="risk-gradient"></div>
                    <div class="risk-labels">
                        <span>0 vi ph·∫°m</span>
                        <span>1-2</span>
                        <span>3-4</span>
                        <span>5+</span>
                    </div>
                </div>
            </div>

            <!-- Map -->
            <div id="map"></div>

            <!-- Custom Popup -->
            <div class="popup-overlay" id="popup-overlay" onclick="closePopup()"></div>
            <div id="custom-popup">
                <div id="popup-views">
                    <!-- List View -->
                    <div id="view-list" class="view-section">
                        <div class="popup-header">
                            <button class="popup-close" onclick="closePopup()">‚úï</button>
                            <h3 id="popup-store-name"></h3>
                            <div class="address" id="popup-store-address"></div>
                        </div>
                        <div class="popup-tabs">
                            <div class="popup-tab violations active" onclick="switchTab('violations')">
                                ‚ö†Ô∏è Vi ph·∫°m (<span id="tab-violations-count">0</span>)
                            </div>
                            <div class="popup-tab rewards" onclick="switchTab('rewards')">
                                üèÜ Khen th∆∞·ªüng (<span id="tab-rewards-count">0</span>)
                            </div>
                        </div>
                        <div class="popup-body" id="popup-body"></div>
                    </div>
                    <!-- Detail View -->
                    <div id="view-detail" class="view-section">
                        <div class="popup-header">
                            <button class="popup-close" onclick="closePopup()">‚úï</button>
                            <button class="back-btn" onclick="backToList()">‚Üê Quay l·∫°i</button>
                            <h3 id="detail-header-title">Chi ti·∫øt vi ph·∫°m</h3>
                        </div>
                        <div class="detail-body" id="detail-body"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- REPORT SECTION -->
    <section id="report-section">
        <div class="report-box">
            <div class="report-title">G·ª≠i ph·∫£n √°nh ·∫©n danh</div>
            <iframe
                src="https://docs.google.com/forms/d/e/1FAIpQLScrXACk6KHdNz0kkWKy2FynUR2xz1GIRJdHdbgGhfPPkGYwig/viewform?embedded=true"
                width="100%" height="800" frameborder="0" marginheight="0" marginwidth="0"
                style="border-radius: 12px; background: transparent;">
                ƒêang t·∫£i form...
            </iframe>
            <p style="text-align:center; font-size:11px; margin-top:20px; color:var(--text-muted);">
                * D·ªØ li·ªáu ƒë∆∞·ª£c b·∫£o m·∫≠t v√† g·ª≠i tr·ª±c ti·∫øp v·ªÅ Ban ki·ªÉm so√°t.
            </p>
        </div>
    </section>

    <!-- FOOTER -->
    <div class="footer">
        <h3 style="font-size: 18px; margin-bottom: 20px; color: var(--text-color);">TH√îNG TIN LI√äN H·ªÜ</h3>
        <div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 18px;">üìç</span>
                <span>ƒê·ªãa ch·ªâ: C√¥ng ty YODY, ƒë∆∞·ªùng An ƒê·ªãnh, ph∆∞·ªùng Vi·ªát H√≤a, th√†nh ph·ªë H·∫£i Ph√≤ng</span>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 18px;">üìû</span>
                <span>Hotline: 0888 673 258</span>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 18px;">‚úâÔ∏è</span>
                <span>Email: Anninhnoibo@yody.vn</span>
            </div>
        </div>
        <p style="font-style: italic; color: var(--text-muted); font-size: 13px;">
            T√†i li·ªáu n·ªôi b·ªô c·ªßa Yody. Nghi√™m c·∫•m h√†nh vi sao ch√©p, chia s·∫ª, ph√°t t√°n d∆∞·ªõi m·ªçi h√¨nh th·ª©c.
        </p>
    </div>

    <script src="js/app.js"></script>
</body>

</html>